<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Donate - PetPaw</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@700;900&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/style.css"/>
  <style>
    :root {
      --coral: #ff6b6b;
      --coral-dark: #e85555;
      --purple: #7c3aed;
      --purple-light: #ede9fe;
      --gold: #f59e0b;
      --gold-light: #fef3c7;
      --teal: #0d9488;
      --dark: #1e1b4b;
      --text: #374151;
      --muted: #9ca3af;
      --bg: #fafafa;
      --white: #ffffff;
    }

    * { box-sizing: border-box; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; }

    /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
    .navbar { background: white !important; border-bottom: 1px solid #f0f0f0; box-shadow: 0 1px 12px rgba(0,0,0,0.06); }
    .navbar-brand { font-family: 'Fraunces', serif; font-size: 1.5rem; color: var(--dark) !important; }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      background: linear-gradient(135deg, #1e1b4b 0%, #4c1d95 45%, #7c3aed 100%);
      padding: 80px 0 100px;
      position: relative;
      overflow: hidden;
    }
    .hero-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.3;
    }
    .blob1 { width: 400px; height: 400px; background: var(--coral); top: -120px; right: -80px; }
    .blob2 { width: 300px; height: 300px; background: var(--gold); bottom: -100px; left: -60px; }
    .blob3 { width: 200px; height: 200px; background: #06b6d4; top: 50%; left: 30%; }

    .hero-tag {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.2);
      color: rgba(255,255,255,0.95);
      border-radius: 999px;
      padding: 6px 18px;
      font-size: 0.78rem; font-weight: 600;
      letter-spacing: 0.08em; text-transform: uppercase;
      margin-bottom: 20px;
    }
    .hero h1 {
      font-family: 'Fraunces', serif;
      font-size: clamp(2.2rem, 5vw, 3.5rem);
      color: white; line-height: 1.15; margin-bottom: 16px;
    }
    .hero h1 span { color: var(--gold); }
    .hero-sub { color: rgba(255,255,255,0.78); font-size: 1.05rem; max-width: 480px; }

    /* floating animals */
    .float-emoji {
      position: absolute;
      font-size: 2.5rem;
      animation: float 4s ease-in-out infinite;
      opacity: 0.6;
    }
    .fe1 { top: 15%; right: 12%; animation-delay: 0s; }
    .fe2 { top: 55%; right: 6%; animation-delay: 1s; font-size: 2rem; }
    .fe3 { bottom: 18%; right: 22%; animation-delay: 2s; font-size: 1.8rem; }
    @keyframes float {
      0%,100% { transform: translateY(0px); }
      50% { transform: translateY(-12px); }
    }

    /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
    .main-wrap { margin-top: -48px; position: relative; z-index: 10; padding-bottom: 60px; }

    /* ‚îÄ‚îÄ FORM CARD ‚îÄ‚îÄ */
    .form-card {
      background: white;
      border-radius: 28px;
      box-shadow: 0 20px 60px rgba(30,27,75,0.12);
      overflow: hidden;
    }
    .form-card-header {
      background: linear-gradient(135deg, #ff6b6b, #e85555);
      padding: 24px 32px;
      display: flex; align-items: center; gap: 14px;
    }
    .form-card-header .icon { font-size: 2rem; }
    .form-card-header h5 { color: white; font-weight: 700; margin: 0; font-size: 1.15rem; }
    .form-card-header p { color: rgba(255,255,255,0.8); margin: 0; font-size: 0.85rem; }
    .form-card-body { padding: 32px; }

    /* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
    .slabel {
      font-size: 0.72rem; font-weight: 700;
      letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--purple); margin-bottom: 12px;
    }

    /* ‚îÄ‚îÄ FUND OPTIONS ‚îÄ‚îÄ */
    .fund-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .fund-opt {
      border: 2px solid #e5e7eb;
      border-radius: 18px; padding: 18px 14px;
      cursor: pointer; text-align: center;
      transition: all 0.22s ease; background: white;
      position: relative; overflow: hidden;
    }
    .fund-opt::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      opacity: 0; transition: opacity 0.22s;
    }
    .fund-opt:hover { border-color: var(--purple); transform: translateY(-2px); }
    .fund-opt.active { border-color: var(--purple); box-shadow: 0 0 0 4px rgba(124,58,237,0.12); }
    .fund-opt.active::before { opacity: 0.06; }
    .fund-emoji { font-size: 2rem; display: block; margin-bottom: 8px; position: relative; }
    .fund-name { font-weight: 700; font-size: 0.9rem; color: var(--dark); position: relative; }
    .fund-desc { font-size: 0.78rem; color: var(--muted); position: relative; }

    /* ‚îÄ‚îÄ AMOUNT BUTTONS ‚îÄ‚îÄ */
    .amt-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-bottom: 14px; }
    .amt-btn {
      border: 2px solid #e5e7eb; background: white;
      border-radius: 14px; padding: 13px 6px;
      font-weight: 700; font-size: 0.95rem;
      cursor: pointer; transition: all 0.18s;
      color: var(--dark);
    }
    .amt-btn:hover { border-color: var(--coral); color: var(--coral); }
    .amt-btn.active {
      background: linear-gradient(135deg, var(--coral), var(--coral-dark));
      border-color: var(--coral); color: white;
      box-shadow: 0 4px 14px rgba(255,107,107,0.35);
    }

    /* ‚îÄ‚îÄ PAYMENT TABS ‚îÄ‚îÄ */
    .pay-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .pay-tab {
      flex: 1; border: 2px solid #e5e7eb; background: white;
      border-radius: 14px; padding: 12px 6px; cursor: pointer;
      text-align: center; transition: all 0.18s;
    }
    .pay-tab i { font-size: 1.3rem; display: block; margin-bottom: 4px; color: var(--muted); transition: color 0.18s; }
    .pay-tab small { font-weight: 600; font-size: 0.78rem; color: var(--muted); }
    .pay-tab:hover { border-color: var(--teal); }
    .pay-tab.active { border-color: var(--teal); background: #f0fdfa; }
    .pay-tab.active i { color: var(--teal); }
    .pay-tab.active small { color: var(--teal); }

    /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
    .form-control, .form-select {
      border: 2px solid #e5e7eb; border-radius: 14px;
      padding: 13px 16px; font-size: 0.93rem;
      transition: border 0.2s, box-shadow 0.2s;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--purple); outline: none;
      box-shadow: 0 0 0 4px rgba(124,58,237,0.1);
    }

    /* ‚îÄ‚îÄ DONATE BUTTON ‚îÄ‚îÄ */
    .btn-donate {
      background: linear-gradient(135deg, var(--coral) 0%, #c0392b 100%);
      border: none; border-radius: 18px; color: white;
      font-size: 1.1rem; font-weight: 700;
      padding: 18px; width: 100%; cursor: pointer;
      letter-spacing: 0.02em;
      transition: all 0.28s ease;
      box-shadow: 0 8px 24px rgba(255,107,107,0.4);
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .btn-donate:hover { transform: translateY(-3px); box-shadow: 0 14px 32px rgba(255,107,107,0.5); }
    .btn-donate:active { transform: translateY(0); }

    .secure-note { font-size: 0.78rem; color: var(--muted); text-align: center; margin-top: 12px; }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */

    /* Impact */
    .impact-card {
      background: linear-gradient(145deg, #1e1b4b 0%, #4c1d95 100%);
      border-radius: 24px; padding: 28px; color: white;
      position: relative; overflow: hidden; margin-bottom: 20px;
    }
    .impact-card::after {
      content: '‚ú®'; position: absolute;
      font-size: 100px; opacity: 0.07;
      bottom: -10px; right: -10px; line-height: 1;
    }
    .impact-title { font-family: 'Fraunces', serif; font-size: 1.25rem; margin-bottom: 20px; }
    .impact-row {
      display: flex; align-items: center; gap: 12px;
      padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .impact-row:last-child { border-bottom: none; }
    .impact-pill {
      background: rgba(245,158,11,0.25); border: 1px solid rgba(245,158,11,0.4);
      color: var(--gold); border-radius: 8px;
      padding: 4px 12px; font-weight: 700; font-size: 0.82rem;
      white-space: nowrap; min-width: 64px; text-align: center;
    }
    .impact-text { font-size: 0.83rem; opacity: 0.82; line-height: 1.35; }

    /* Recent */
    .recent-card {
      background: white; border-radius: 24px;
      padding: 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.07);
    }
    .donor-row {
      display: flex; align-items: center;
      justify-content: space-between;
      padding: 10px 0; border-bottom: 1px solid #f5f5f5;
    }
    .donor-row:last-child { border-bottom: none; }
    .donor-av {
      width: 36px; height: 36px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.85rem; flex-shrink: 0;
      color: white;
    }
    .av-coral { background: linear-gradient(135deg, var(--coral), #c0392b); }
    .av-purple { background: linear-gradient(135deg, var(--purple), #6d28d9); }
    .av-teal { background: linear-gradient(135deg, var(--teal), #0f766e); }
    .av-gold { background: linear-gradient(135deg, var(--gold), #d97706); }

    .amt-chip {
      background: var(--gold-light); border: 1.5px solid #fcd34d;
      border-radius: 8px; padding: 3px 10px;
      font-weight: 700; font-size: 0.82rem; color: #92400e;
    }

    /* Stats row */
    .mini-stats {
      background: white; border-radius: 18px;
      padding: 16px 24px; margin-bottom: 20px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
      display: flex; gap: 0;
    }
    .mini-stat { flex: 1; text-align: center; }
    .mini-stat + .mini-stat { border-left: 1px solid #f0f0f0; }
    .mini-stat-num { font-size: 1.5rem; font-weight: 700; font-family: 'Fraunces', serif; color: var(--dark); }
    .mini-stat-label { font-size: 0.72rem; color: var(--muted); font-weight: 500; }

    .divider { height: 1px; background: #f3f4f6; margin: 24px 0; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="/static/index.html"><i class="fas fa-paw me-2 text-success"></i>PetPaw</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="/static/index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/static/shelters.html">Shelters</a></li>
          <li class="nav-item"><a class="nav-link fw-bold" style="color:var(--coral);" href="/static/donate.html">Donate</a></li>
          <li class="nav-item"><a class="nav-link" href="/static/my-adoptions.html">My Adoptions</a></li>
          <li class="nav-item"><a class="nav-link" href="/static/my-favorites.html">‚ù§Ô∏è Favorites</a></li>
          <li class="nav-item"><a class="nav-link" href="/static/contact-shelter.html">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="/static/login.html">Login</a></li>
          <li class="nav-item ms-2">
            <a class="btn btn-success px-4 rounded-pill" href="/static/register.html">Register</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-blob blob1"></div>
    <div class="hero-blob blob2"></div>
    <div class="hero-blob blob3"></div>
    <span class="float-emoji fe1">üê∂</span>
    <span class="float-emoji fe2">üê±</span>
    <span class="float-emoji fe3">üêæ</span>
    <div class="container position-relative">
      <div class="row align-items-center">
        <div class="col-lg-7">
          <div class="hero-tag">‚ù§Ô∏è Make a difference</div>
          <h1>Be a Hero for<br><span>Homeless Animals</span></h1>
          <p class="hero-sub">Your donation feeds, heals, and rehomes animals waiting for their forever family. Every rupee counts.</p>
        </div>
      </div>
    </div>
  </section>

  <div class="main-wrap">
    <div class="container">
      <div class="row g-4 justify-content-center">

        <!-- Form -->
        <div class="col-lg-7">
          <div class="form-card">
            <div class="form-card-header">
              <span class="icon">üíù</span>
              <div>
                <h5>Make Your Donation</h5>
                <p>100% goes directly to animal care</p>
              </div>
            </div>
            <div class="form-card-body">

              <p class="slabel">Donate to</p>
              <div class="fund-grid mb-4">
                <div class="fund-opt active" id="opt-general" onclick="selectDonationType('general')">
                  <span class="fund-emoji">üêæ</span>
                  <div class="fund-name">General Fund</div>
                  <div class="fund-desc">Support all animals</div>
                </div>
                <div class="fund-opt" id="opt-shelter" onclick="selectDonationType('shelter')">
                  <span class="fund-emoji">üè†</span>
                  <div class="fund-name">Specific Shelter</div>
                  <div class="fund-desc">Choose a shelter</div>
                </div>
              </div>

              <div class="mb-4" id="shelterDropdown" style="display:none;">
                <p class="slabel">Select shelter</p>
                <select class="form-select" id="shelterSelect">
                  <option value="">-- Choose a shelter --</option>
                </select>
              </div>

              <div class="divider"></div>

              <p class="slabel">Choose amount (‚Çπ)</p>
              <div class="amt-grid">
                <button class="amt-btn" onclick="selectAmount(100,this)">‚Çπ100</button>
                <button class="amt-btn" onclick="selectAmount(250,this)">‚Çπ250</button>
                <button class="amt-btn" onclick="selectAmount(500,this)">‚Çπ500</button>
                <button class="amt-btn" onclick="selectAmount(1000,this)">‚Çπ1,000</button>
                <button class="amt-btn" onclick="selectAmount(2000,this)">‚Çπ2,000</button>
                <button class="amt-btn" onclick="selectAmount(5000,this)">‚Çπ5,000</button>
              </div>
              <input type="number" class="form-control mt-3 mb-4" id="amountInput" placeholder="Or enter custom amount" min="1">

              <div class="divider"></div>

              <p class="slabel">Payment method</p>
              <div class="pay-tabs">
                <div class="pay-tab active" id="pm-upi" onclick="selectPayment('upi')">
                  <i class="fas fa-mobile-alt"></i><small>UPI</small>
                </div>
                <div class="pay-tab" id="pm-card" onclick="selectPayment('card')">
                  <i class="fas fa-credit-card"></i><small>Card</small>
                </div>
                <div class="pay-tab" id="pm-netbanking" onclick="selectPayment('netbanking')">
                  <i class="fas fa-university"></i><small>Net Banking</small>
                </div>
              </div>

              <div id="upi-fields">
                <p class="slabel">UPI ID</p>
                <input type="text" class="form-control mb-4" id="upiId" placeholder="yourname@upi">
              </div>
              <div id="card-fields" style="display:none;">
                <p class="slabel">Card details</p>
                <input type="text" class="form-control mb-2" id="cardNumber" placeholder="Card Number" maxlength="19">
                <div class="row g-2 mb-4">
                  <div class="col-6"><input type="text" class="form-control" id="cardExpiry" placeholder="MM/YY" maxlength="5"></div>
                  <div class="col-6"><input type="password" class="form-control" id="cardCvv" placeholder="CVV" maxlength="3"></div>
                </div>
              </div>
              <div id="netbanking-fields" style="display:none;">
                <p class="slabel">Select bank</p>
                <select class="form-select mb-4" id="bankSelect">
                  <option value="">Choose your bank</option>
                  <option>State Bank of India</option>
                  <option>HDFC Bank</option>
                  <option>ICICI Bank</option>
                  <option>Axis Bank</option>
                  <option>Kotak Mahindra Bank</option>
                  <option>Punjab National Bank</option>
                </select>
              </div>

              <div class="divider"></div>

              <p class="slabel">Message (optional)</p>
              <textarea class="form-control mb-4" id="donationMessage" rows="2" placeholder="Leave kind words for the animals..."></textarea>

              <div id="donationResult" class="mb-3"></div>

              <button class="btn-donate" onclick="submitDonation()">
                ‚ù§Ô∏è &nbsp;Donate Now
              </button>
              <p class="secure-note"><i class="fas fa-lock me-1"></i>Simulated payment ‚Äî no real money charged</p>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">

          <!-- Mini stats -->
          <div class="mini-stats">
            <div class="mini-stat">
              <div class="mini-stat-num" id="totalDonors">‚Äî</div>
              <div class="mini-stat-label">Donors</div>
            </div>
            <div class="mini-stat">
              <div class="mini-stat-num" id="totalRaised">‚Äî</div>
              <div class="mini-stat-label">Raised</div>
            </div>
          </div>

          <!-- Impact card -->
          <div class="impact-card">
            <div class="impact-title">Your Impact ‚ú®</div>
            <div class="impact-row">
              <span class="impact-pill">‚Çπ100</span>
              <span class="impact-text">Feeds a shelter pet for a week</span>
            </div>
            <div class="impact-row">
              <span class="impact-pill">‚Çπ500</span>
              <span class="impact-text">Covers a basic medical checkup</span>
            </div>
            <div class="impact-row">
              <span class="impact-pill">‚Çπ1,000</span>
              <span class="impact-text">Vaccinations for 2 pets</span>
            </div>
            <div class="impact-row">
              <span class="impact-pill">‚Çπ2,000+</span>
              <span class="impact-text">Sponsors full monthly pet care</span>
            </div>
          </div>

          <!-- Recent donations -->
          <div class="recent-card">
            <p class="slabel">Recent donations</p>
            <div id="recentDonations">
              <div class="text-center py-3"><div class="spinner-border spinner-border-sm" style="color:var(--coral);"></div></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 rounded-4 overflow-hidden">
        <div style="background:linear-gradient(135deg,#ff6b6b,#c0392b);padding:28px;text-align:center;">
          <div style="font-size:3.5rem;">üéâ</div>
        </div>
        <div class="modal-body text-center p-4">
          <h4 class="fw-bold" style="font-family:'Fraunces',serif;color:var(--dark);">Thank You!</h4>
          <p class="text-muted" id="successMessage">Your donation has been recorded.</p>
          <a href="/static/index.html" class="btn btn-success px-5 rounded-pill">Back to Home</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-dark text-white text-center py-4">
    <p class="mb-0">¬© 2026 PetPaw - Made with ‚ù§Ô∏è for animals</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/main.js"></script>
  <script>
    let selectedPayment = 'upi';
    let donationType = 'general';
    const avClasses = ['av-coral','av-purple','av-teal','av-gold'];

    async function loadShelterOptions() {
      try {
        const res = await fetch('/api/shelters');
        const data = await res.json();
        const sel = document.getElementById('shelterSelect');
        sel.innerHTML = '<option value="">-- Choose a shelter --</option>';
        (data.shelters||[]).forEach(s => sel.innerHTML += `<option value="${s.id}">${s.name}</option>`);
      } catch(e){}
    }

    async function loadRecentDonations() {
      try {
        const res = await fetch('/api/donations/recent');
        const data = await res.json();
        const c = document.getElementById('recentDonations');
        if (!data.donations||!data.donations.length) {
          c.innerHTML = '<p class="text-muted small text-center py-2">No donations yet ‚Äî be the first! üêæ</p>';
          document.getElementById('totalDonors').textContent = '0';
          document.getElementById('totalRaised').textContent = '‚Çπ0';
          return;
        }
        document.getElementById('totalDonors').textContent = data.donations.length;
        const total = data.donations.reduce((s,d) => s + Number(d.amount), 0);
        document.getElementById('totalRaised').textContent = total >= 1000 ? `‚Çπ${(total/1000).toFixed(1)}k` : `‚Çπ${total}`;

        c.innerHTML = data.donations.map((d,i) => {
          const name = d.donor_name || 'Anonymous';
          const initial = name === 'Anonymous' ? '?' : name[0].toUpperCase();
          const avClass = avClasses[i % avClasses.length];
          return `<div class="donor-row">
            <div class="d-flex align-items-center gap-2">
              <div class="donor-av ${avClass}">${initial}</div>
              <div>
                <p class="mb-0 fw-bold" style="font-size:.84rem;">${name}</p>
                <p class="mb-0" style="font-size:.73rem;color:#9ca3af;">${d.shelters?.name||'General Fund'}</p>
              </div>
            </div>
            <span class="amt-chip">‚Çπ${d.amount}</span>
          </div>`;
        }).join('');
      } catch(e) {
        document.getElementById('recentDonations').innerHTML = '<p class="text-muted small text-center">Unable to load.</p>';
      }
    }

    function selectDonationType(type) {
      donationType = type;
      document.getElementById('opt-general').classList.toggle('active', type==='general');
      document.getElementById('opt-shelter').classList.toggle('active', type==='shelter');
      document.getElementById('shelterDropdown').style.display = type==='shelter' ? 'block' : 'none';
    }

    function selectAmount(val, btn) {
      document.getElementById('amountInput').value = val;
      document.querySelectorAll('.amt-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function selectPayment(method) {
      selectedPayment = method;
      ['upi','card','netbanking'].forEach(m => {
        document.getElementById(`pm-${m}`).classList.toggle('active', m===method);
        document.getElementById(`${m}-fields`).style.display = m===method ? 'block' : 'none';
      });
    }

    async function submitDonation() {
      const user = getCurrentUser();
      if (!user) { alert('Please login to donate!'); location.href='/static/login.html'; return; }
      const amount = parseFloat(document.getElementById('amountInput').value);
      if (!amount||amount<1) {
        document.getElementById('donationResult').innerHTML='<div class="alert alert-warning rounded-3">Please enter a valid amount.</div>';
        return;
      }
      const shelterId = donationType==='shelter' ? document.getElementById('shelterSelect').value : null;
      if (donationType==='shelter'&&!shelterId) {
        document.getElementById('donationResult').innerHTML='<div class="alert alert-warning rounded-3">Please select a shelter.</div>';
        return;
      }
      document.getElementById('donationResult').innerHTML=
        '<div class="alert alert-info rounded-3"><div class="spinner-border spinner-border-sm me-2"></div>Processing...</div>';
      await new Promise(r=>setTimeout(r,1500));
      try {
        const res = await fetch('/api/donations',{
          method:'POST',
          headers:{'Content-Type':'application/json','Authorization':`Bearer ${localStorage.getItem('token')||''}`},
          body:JSON.stringify({donor_id:user.id,shelter_id:shelterId||null,amount,currency:'INR',payment_method:selectedPayment,status:'completed'})
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error||'Failed');
        document.getElementById('successMessage').textContent=`Your donation of ‚Çπ${amount} has been recorded. Thank you! üêæ`;
        new bootstrap.Modal(document.getElementById('successModal')).show();
        document.getElementById('donationResult').innerHTML='';
        loadRecentDonations();
      } catch(err) {
        document.getElementById('donationResult').innerHTML=`<div class="alert alert-danger rounded-3">${err.message}</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded',()=>{loadShelterOptions();loadRecentDonations();});
  </script>
</body>
</html>